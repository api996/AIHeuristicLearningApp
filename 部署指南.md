# AI学习伙伴项目部署指南

本指南将帮助您成功部署AI学习伙伴项目到Replit平台上。

## 部署前准备

### 1. 修改 package.json

请按照 `package-json-changes.md` 文件中的建议修改您的 package.json 文件。这些修改包括：
- 增加内存限制以避免构建时内存不足错误
- 添加部署准备和生产启动脚本

### 2. 运行部署准备脚本

在部署前，运行以下命令来准备您的代码库：

```bash
chmod +x deploy-prepare.sh
./deploy-prepare.sh
```

或者使用npm脚本（如果您已按照建议修改了package.json）：

```bash
npm run deploy:prepare
```

这将清理旧的构建文件，优化构建过程，并生成生产环境代码。

## 部署配置

在部署前，请确保您的 `.replit` 文件包含正确的部署配置。由于无法直接修改此文件，请通过Replit界面进行以下设置：

1. 点击左侧的"Tools"菜单
2. 选择"Deployments"
3. 配置部署设置：
   - 设置构建命令为：`NODE_ENV=production npm run build`
   - 设置运行命令为：`node dist/index.js`

## 环境变量

确保在部署环境中设置了所有必要的环境变量，特别是：

1. 数据库连接字符串
2. API密钥（如果使用）
3. NODE_ENV=production

## 部署步骤

1. 确保所有代码已提交到仓库
2. 点击"Deploy"按钮
3. 等待构建和部署过程完成
4. 访问给定的URL以验证部署是否成功

## 故障排除

如果部署失败，请检查：

1. 构建日志中是否有错误信息
2. 是否按照以上步骤正确配置了部署环境
3. 内存使用是否超出限制（可能需要调整NODE_OPTIONS中的内存设置）

如果出现错误代码143，这通常表示进程被强制终止，可能是因为内存不足。请使用我们提供的优化脚本再次尝试。

## 重要注意事项

- 生产环境中将使用`NODE_ENV=production`
- 数据库连接应当配置为能够在部署环境中访问
- 部署后，任何本地文件更改将不会保留（如记忆文件），请确保使用的是数据库存储