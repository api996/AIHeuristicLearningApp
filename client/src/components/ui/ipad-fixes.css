/* iPad和平板设备特定修复 - 全新响应式布局技术 */

/**
 * 新的主布局策略:
 * 1. 使用CSS Grid和Flexbox实现真正的响应式布局
 * 2. 固定底部输入框，默认贴底
 * 3. 美化输入框样式，实现玻璃态效果
 * 4. 完全避免任何绝对定位
 */

/* ===== iPad/平板专用布局(768px-1366px) ===== */
@media screen and (min-width: 768px) and (max-width: 1366px) {
  /* ===== 基础容器结构 ===== */
  .ipad-device #root,
  .tablet-device #root {
    width: 100vw !important;
    height: 100vh !important;
    overflow: hidden !important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
  }
  
  /* 主容器布局结构 - 使用二栏布局grid */
  .ipad-device .flex.h-screen,
  .tablet-device .flex.h-screen {
    display: grid !important;
    grid-template-columns: 256px 1fr !important; /* 固定宽度侧边栏 + 自适应内容区 */
    height: 100vh !important;
    max-height: 100vh !important;
    width: 100vw !important;
    max-width: 100vw !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
  }
  
  /* ===== 侧边栏样式 ===== */
  /* 侧边栏容器 - 完全流体布局 */
  .ipad-device .sidebar-container,
  .tablet-device .sidebar-container {
    position: relative !important; /* 使用相对定位 */
    width: 100% !important;
    height: 100% !important;
    overflow-y: auto !important;
    background-color: rgba(0, 0, 0, 0.8) !important;
    border-right: 1px solid rgba(255, 255, 255, 0.1) !important;
    max-width: 256px !important;
    z-index: 40 !important;
  }
  
  /* ===== 主内容区域样式 ===== */
  /* 主内容容器 - 完全流体布局 */
  .ipad-device .chat-content-area,
  .tablet-device .chat-content-area {
    position: relative !important;
    width: 100% !important;
    height: 100vh !important;
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
    margin: 0 !important;
    padding: 0 !important;
  }
  
  /* ===== 聊天消息容器样式 ===== */
  /* 聊天消息外层容器 - 流体布局 - 完全改进版 */
  .ipad-device .chat-message-container,
  .tablet-device .chat-message-container {
    flex: 1 !important;
    width: 100% !important;
    position: relative !important;
    overflow-y: auto !important;
    display: flex !important;
    flex-direction: column !important;
    padding-bottom: 120px !important; /* 为底部输入框留出空间 */
    
    /* 处理与侧边栏的关系 */
    padding-left: 256px !important; /* 为侧边栏预留空间 */
    box-sizing: border-box !important;
  }

  /* 当侧边栏隐藏时重置内边距 */
  .ipad-device .sidebar-container.hidden ~ .chat-content-area .chat-message-container,
  .tablet-device .sidebar-container.hidden ~ .chat-content-area .chat-message-container {
    padding-left: 0 !important;
  }
  
  /* 内容真正居中的容器 - 改进版 */
  .ipad-device .chat-message-container > div,
  .tablet-device .chat-message-container > div {
    width: 100% !important;
    max-width: 650px !important; /* 限制最大宽度，与输入框一致 */
    margin-left: auto !important;
    margin-right: auto !important;
    padding: 0 !important; /* 移除内边距，由子元素控制 */
  }
  
  /* 消息区域滚动容器 */
  .ipad-device .vh-chat-messages,
  .tablet-device .vh-chat-messages {
    width: 100% !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
  }
  
  /* 每条消息容器 - 设置合理的最大宽度 */
  .ipad-device .message-appear,
  .tablet-device .message-appear {
    width: 100% !important;
    max-width: 85% !important; /* 限制宽度使消息更集中 */
    margin-left: auto !important;
    margin-right: auto !important;
  }
  
  /* ===== 改进聊天输入区样式 ===== */
  /* 输入区域容器 - 核心修复：完全重写，不再使用固定偏移 */
  .ipad-device .chat-input-area,
  .tablet-device .chat-input-area {
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    width: 100% !important; /* 占满整个宽度 */
    z-index: 50 !important;
    padding: 16px 0 !important; /* 移除横向内边距，由内部元素控制 */
    background: rgba(30, 30, 30, 0.8) !important;
    backdrop-filter: blur(15px) !important;
    -webkit-backdrop-filter: blur(15px) !important;
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    transition: all 0.3s ease !important;
    
    /* 重要：添加内部内容容器左移以适应侧边栏 */
    display: flex !important;
    justify-content: center !important;
    padding-left: 256px !important; /* 侧边栏宽度 */
    box-sizing: border-box !important;
  }
  
  /* 当侧边栏隐藏时，取消向左的偏移 */
  .ipad-device .sidebar-container.hidden ~ .chat-content-area .chat-input-area,
  .tablet-device .sidebar-container.hidden ~ .chat-content-area .chat-input-area {
    padding-left: 0 !important;
  }
  
  /* 输入区域居中内容容器 - 与消息容器宽度一致 */
  .ipad-device .chat-input-area > div,
  .tablet-device .chat-input-area > div {
    max-width: 700px !important;
    width: 100% !important;
    padding: 0 !important;
  }
  
  /* 键盘打开时的特殊处理 - 非常重要！ */
  .ipad-device.keyboard-open .chat-input-area,
  .tablet-device.keyboard-open .chat-input-area {
    position: fixed !important;
    bottom: 0 !important;
    padding-left: 0 !important; /* 键盘打开时不要左偏移！ */
    justify-content: center !important;
    z-index: 9999 !important;
    transform: translateY(0) !important;
    width: 100% !important;
    left: 0 !important;
    right: 0 !important;
  }
  
  /* 美化输入框外观 */
  .ipad-device .chat-input-area .relative.rounded-xl,
  .tablet-device .chat-input-area .relative.rounded-xl {
    border-radius: 24px !important;
    background: rgba(255, 255, 255, 0.05) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    overflow: hidden !important;
  }
  
  /* 发送按钮美化 */
  .ipad-device .chat-input-area button[class*="rounded-full"],
  .tablet-device .chat-input-area button[class*="rounded-full"] {
    background: linear-gradient(to right, #6366f1, #8b5cf6) !important;
    border: none !important;
    box-shadow: 0 2px 10px rgba(99, 102, 241, 0.5) !important;
    transform: scale(1.1) !important;
  }
}

/* ===== 专门针对iPad Pro(12.9英寸)的优化 ===== */
@media screen and (min-width: 1024px) and (max-width: 1366px) {
  .ipad-device .chat-message-container > div,
  .tablet-device .chat-message-container > div,
  .ipad-device .chat-input-area > div,
  .tablet-device .chat-input-area > div {
    max-width: 800px !important; /* 更大屏幕允许更宽的内容 */
  }
  
  .ipad-device .message-appear,
  .tablet-device .message-appear {
    max-width: 80% !important; /* 在大屏上可以稍微窄一点 */
  }
}

/* ===== 处理iPad横屏/竖屏特定情况 ===== */
/* 横屏模式 - 布局更宽 */
@media screen and (min-width: 768px) and (max-width: 1366px) and (orientation: landscape) {
  .ipad-device.landscape .chat-message-container > div,
  .tablet-device.landscape .chat-message-container > div {
    max-width: 800px !important;
    padding: 0 30px !important;
  }
}

/* 竖屏模式 - 布局更窄 */
@media screen and (min-width: 768px) and (max-width: 1366px) and (orientation: portrait) {
  .ipad-device.portrait .chat-message-container > div,
  .tablet-device.portrait .chat-message-container > div {
    max-width: 650px !important;
    padding: 0 24px !important;
  }
}