/*
 * 知识图谱页面在iPad上的滚动和交互修复 - 强化版
 * 确保知识图谱页面在iPad上可以正常滚动和交互，防止内容溢出
 * 专门针对SVG图谱的触摸操作和性能优化
 */

/* iPad设备上的知识图谱页面滚动修复 - 强化版 */
.ipad-device .knowledge-graph-container,
.tablet-device .knowledge-graph-container {
  width: 100% !important;
  height: auto !important;
  min-height: 70vh !important; 
  max-height: none !important; /* 移除最大高度限制 */
  position: relative !important;
  overflow: visible !important;
  touch-action: manipulation !important; /* 允许触摸手势操作 */
  -webkit-overflow-scrolling: touch !important;
  transform: translateZ(0) !important; /* 启用硬件加速 */
  will-change: transform !important; /* 提升性能 */
  display: block !important; /* 确保块级显示 */
  margin: 0 auto !important; /* 水平居中 */
  background-color: transparent !important; /* 确保背景透明 */
}

/* 图谱详情页面容器修复 - 强化版 */
.ipad-device .knowledge-graph-detail-page,
.tablet-device .knowledge-graph-detail-page {
  overflow-y: auto !important;
  -webkit-overflow-scrolling: touch !important;
  max-height: 100vh !important;
  min-height: 100vh !important;
  width: 100% !important;
  padding-bottom: 80px !important; /* 增加底部间距 */
  position: relative !important;
  display: flex !important;
  flex-direction: column !important;
  overscroll-behavior: contain !important; /* 防止过度滚动 */
}

/* 知识图谱标题区域修复 */
.ipad-device .knowledge-graph-detail-page .flex.justify-between.items-center.mb-6,
.tablet-device .knowledge-graph-detail-page .flex.justify-between.items-center.mb-6 {
  position: sticky !important; 
  top: 0 !important;
  z-index: 10 !important;
  background-color: rgba(17, 17, 24, 0.8) !important;
  backdrop-filter: blur(10px) !important;
  -webkit-backdrop-filter: blur(10px) !important;
  padding: 1rem 0 !important;
  margin-bottom: 1rem !important;
}

/* 确保图谱容器不会被隐藏或裁剪 - 强化版 */
.ipad-device .knowledge-graph-container svg,
.tablet-device .knowledge-graph-container svg {
  touch-action: manipulation !important; /* 允许触摸手势操作 */
  pointer-events: auto !important; /* 确保事件能够正常触发 */
  overflow: visible !important;
  height: 100% !important;
  width: 100% !important;
  -webkit-user-select: none !important; /* 防止文本选择 */
  user-select: none !important;
  -webkit-touch-callout: none !important; /* 防止长按菜单 */
  cursor: move !important; /* 提示用户可拖动 */
  transform: translateZ(0) !important; /* 启用硬件加速 */
  will-change: transform !important; /* 提升性能 */
  backface-visibility: hidden !important; /* 提升3D性能 */
  position: relative !important;
  z-index: 1 !important;
}

/* SVG内部元素修复 */
.ipad-device .knowledge-graph-container svg g,
.tablet-device .knowledge-graph-container svg g,
.ipad-device .knowledge-graph-container svg circle,
.tablet-device .knowledge-graph-container svg circle,
.ipad-device .knowledge-graph-container svg path,
.tablet-device .knowledge-graph-container svg path,
.ipad-device .knowledge-graph-container svg line,
.tablet-device .knowledge-graph-container svg line {
  touch-action: manipulation !important;
  pointer-events: auto !important;
  -webkit-user-select: none !important;
  user-select: none !important;
  -webkit-touch-callout: none !important;
}

/* 确保节点可点击 */
.ipad-device .knowledge-graph-container svg g.nodes circle,
.tablet-device .knowledge-graph-container svg g.nodes circle {
  cursor: pointer !important;
  -webkit-tap-highlight-color: transparent !important; /* 移除高亮 */
}

/* 控制按钮区域修复 - 强化版 */
.ipad-device .graph-controls,
.tablet-device .graph-controls {
  position: fixed !important; /* 固定定位，确保始终可见 */
  top: 20px !important;
  right: 20px !important;
  z-index: 50 !important;
  background: rgba(17, 24, 39, 0.8) !important; /* 深色背景 */
  backdrop-filter: blur(10px) !important;
  -webkit-backdrop-filter: blur(10px) !important;
  border-radius: 12px !important;
  padding: 10px !important;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3) !important;
  display: flex !important;
  flex-direction: column !important;
  gap: 8px !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  transform: translateZ(0) !important; /* 启用硬件加速 */
}

/* 按钮样式强化 */
.ipad-device .graph-controls button,
.tablet-device .graph-controls button {
  width: 40px !important;
  height: 40px !important;
  border-radius: 8px !important;
  background: rgba(255, 255, 255, 0.1) !important;
  color: white !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  border: none !important;
  outline: none !important;
  transition: all 0.2s ease !important;
  -webkit-tap-highlight-color: transparent !important;
  margin: 4px !important;
}

/* 图例区域修复 - 强化版 */
.ipad-device .graph-legend,
.tablet-device .graph-legend {
  position: fixed !important; /* 固定定位，确保始终可见 */
  bottom: 20px !important;
  left: 20px !important;
  z-index: 50 !important;
  background: rgba(17, 24, 39, 0.8) !important; /* 深色背景 */
  backdrop-filter: blur(10px) !important;
  -webkit-backdrop-filter: blur(10px) !important;
  border-radius: 12px !important;
  padding: 12px !important;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3) !important;
  display: flex !important;
  flex-direction: column !important;
  gap: 8px !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  transform: translateZ(0) !important; /* 启用硬件加速 */
}

/* 预览容器修复 */
.ipad-device .preview-container,
.tablet-device .preview-container {
  max-height: 500px !important;
  overflow: auto !important;
  -webkit-overflow-scrolling: touch !important;
  margin-top: 1rem !important;
  border-radius: 8px !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
}

/* 卡片内容修复 */
.ipad-device .knowledge-graph-detail-page .card-content,
.tablet-device .knowledge-graph-detail-page .card-content {
  max-height: 70vh !important;
  overflow-y: auto !important;
  -webkit-overflow-scrolling: touch !important;
  padding: 1rem !important;
}

/* 全屏模式下的特殊修复 */
.ipad-device .fullscreen-graph,
.tablet-device .fullscreen-graph,
.ipad-device .knowledge-graph-container.fullscreen,
.tablet-device .knowledge-graph-container.fullscreen {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  z-index: 9999 !important;
  background: rgba(10, 10, 20, 0.95) !important;
  padding: 20px !important;
  display: flex !important;
  flex-direction: column !important;
  overflow: hidden !important;
}

/* iOS Safari特定修复 - 强化版 2.0 */
@supports (-webkit-touch-callout: none) {
  .knowledge-graph-container,
  .knowledge-graph-detail-page,
  .knowledge-graph-view-page {
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    touch-action: manipulation !important;
    overscroll-behavior: contain !important;
    -webkit-tap-highlight-color: transparent !important; /* 移除高亮 */
    height: auto !important;
    max-height: 100vh !important;
  }
  
  .knowledge-graph-container svg,
  .knowledge-graph-detail-page svg,
  .knowledge-graph-view-page svg {
    touch-action: manipulation !important;
    transform: translateZ(0) !important;
    -webkit-user-select: none !important;
    user-select: none !important;
  }
  
  /* 额外的iOS修复 */
  .ipad-device .knowledge-graph-container div,
  .tablet-device .knowledge-graph-container div,
  .ipad-device .knowledge-graph-detail-page div,
  .tablet-device .knowledge-graph-detail-page div,
  .ipad-device .knowledge-graph-view-page div,
  .tablet-device .knowledge-graph-view-page div {
    transform: translateZ(0) !important;
    backface-visibility: hidden !important;
    perspective: 1000px !important;
  }
  
  /* 处理菜单和对话框 */
  .ipad-device [role="dialog"],
  .tablet-device [role="dialog"],
  .ipad-device [role="menu"],
  .tablet-device [role="menu"] {
    -webkit-overflow-scrolling: touch !important;
    touch-action: manipulation !important;
    z-index: 100 !important;
  }
  
  /* 知识图谱详情页面内的所有卡片 */
  .ipad-device .knowledge-graph-detail-page .card,
  .tablet-device .knowledge-graph-detail-page .card {
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    max-height: 70vh !important;
    height: auto !important;
    transform: translateZ(0) !important; /* 启用硬件加速 */
  }
  
  /* 知识图谱的子组件 */
  .ipad-device .tabs-content,
  .tablet-device .tabs-content,
  .ipad-device [data-state="active"],
  .tablet-device [data-state="active"] {
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    max-height: none !important;
    height: auto !important;
  }
}