modules = ["nodejs-20", "bash", "web", "postgresql-16"]
run = "npm run dev"
hidden = [".config", ".git", "generated-icon.png", "node_modules", "dist"]

[nix]
channel = "stable-24_05"

[deployment]
deploymentTarget = "cloudrun"
run = ["sh", "-c", "npm run dev"]

[[ports]]
localPort = 5000
externalPort = 80

[[ports]]
localPort = 5001

[workflows]
runButton = "重启并检查环境变量"

[[workflows.workflow]]
name = "Project"
mode = "parallel"
author = "agent"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Start application"

[[workflows.workflow]]
name = "Start application"
author = "agent"

[workflows.workflow.metadata]
agentRequireRestartOnSave = false

[[workflows.workflow.tasks]]
task = "packager.installForAll"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"
waitForPort = 5000

[[workflows.workflow]]
name = "Start application (fixed)"
author = 40327554
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pkill -f \"tsx server/index.ts\" || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"

[[workflows.workflow]]
name = "Start application (clean)"
author = 40327554
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pkill -f \"tsx server/index.ts\" || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"

[[workflows.workflow]]
name = "重新启动应用"
author = 40327554
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pkill -f \"tsx server/index.ts\" || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "kill $(lsof -t -i:3000) 2>/dev/null || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"

[[workflows.workflow]]
name = "重启并修复管理员"
author = 40327554
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pkill -f \"tsx server/index.ts\" || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "kill $(lsof -t -i:3000) 2>/dev/null || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"

[[workflows.workflow]]
name = "重启服务器"
author = 40327554
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pkill -f \"tsx server/index.ts\" || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "kill $(lsof -t -i:3000) 2>/dev/null || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"

[[workflows.workflow]]
name = "重启并修复问题"
author = 40327554
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pkill -f \"tsx server/index.ts\" || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "kill $(lsof -t -i:3000) 2>/dev/null || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "kill $(lsof -t -i:5000) 2>/dev/null || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"

[[workflows.workflow]]
name = "重启应用并修复错误"
author = 40327554
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pkill -f \"tsx server/index.ts\" || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "kill $(lsof -t -i:5000) 2>/dev/null || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"

[[workflows.workflow]]
name = "彻底重启应用"
author = 40327554
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pkill -f \"tsx server/index.ts\" || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pkill -f node || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "kill $(lsof -t -i:5000) 2>/dev/null || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"

[[workflows.workflow]]
name = "修复用户认证问题"
author = 40327554
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pkill -f \"tsx server/index.ts\" || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "kill $(lsof -t -i:5000) 2>/dev/null || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"

[[workflows.workflow]]
name = "重启并检查环境变量"
author = 40327554
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "pkill -f \"tsx server/index.ts\" || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "kill $(lsof -t -i:5000) 2>/dev/null || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"正在检查环境变量...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "env | grep -E \"TURNSTILE|VITE\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"

[[workflows.workflow]]
name = "显示所有密钥和环境变量"
author = 40327554
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"===== 所有环境变量 =====\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "env"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = 'echo "\n===== Replit Secrets ====="'

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"TURNSTILE_SITE_KEY: ${TURNSTILE_SITE_KEY:-未设置}\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"TURNSTILE_SECRET_KEY: ${TURNSTILE_SECRET_KEY:-未设置}\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"VITE_TURNSTILE_SITE_KEY: ${VITE_TURNSTILE_SITE_KEY:-未设置}\""
